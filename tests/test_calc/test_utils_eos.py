"""Tests of utility functions for EOS fitting."""

import numpy as np
import pytest

from pypolymlp.calculator.utils.eos_utils import EOS


def test_eos():
    """Test EOS."""
    data = [
        [53.562836, -30.01456434],
        [55.85838611, -32.81830594],
        [58.15393622, -35.03145356],
        [60.44948634, -36.72186202],
        [62.74503645, -37.95332728],
        [65.04058657, -38.83307902],
        [67.33613668, -39.44039753],
        [68.86650342, -39.72506771],
        [69.63168679, -39.83733059],
        [70.39687017, -39.93191466],
        [71.16205354, -40.01045385],
        [71.92723691, -40.07447139],
        [72.69242028, -40.12538105],
        [73.45760365, -40.16448727],
        [74.22278702, -40.19298493],
        [74.98797039, -40.21195889],
        [75.75315377, -40.22238403],
        [76.51833714, -40.22512569],
        [77.28352051, -40.22094114],
        [78.04870388, -40.21048191],
        [78.81388725, -40.19377513],
        [79.57907062, -40.17007409],
        [80.34425399, -40.13944139],
        [81.10943736, -40.1019236],
        [81.87462074, -40.05753428],
        [82.63980411, -40.006263],
        [83.40498748, -39.94808363],
        [84.17017085, -39.88296204],
        [84.17017085, -39.88296204],
        [86.46572096, -39.645626],
        [88.76127108, -39.34280388],
        [91.05682119, -38.96655503],
        [93.35237131, -38.52066654],
        [95.64792142, -38.01262631],
        [97.94347153, -37.45226996],
        [100.23902165, -36.85029171],
        [102.53457176, -36.21711964],
        [104.83012188, -35.56557385],
        [107.12567199, -34.90800524],
        [109.42122211, -34.25541245],
        [111.71677222, -33.61686893],
        [114.01232233, -32.99689719],
        [116.30787245, -32.39538781],
        [118.60342256, -31.81578],
        [120.89897268, -31.25935532],
        [123.19452279, -30.72522055],
        [125.4900729, -30.2106525],
        [127.78562302, -29.71151505],
        [130.08117313, -29.22253097],
        [132.37672325, -28.73438258],
        [134.67227336, -28.24109577],
        [136.96782347, -27.73862407],
        [139.26337359, -27.22319689],
        [141.5589237, -26.69154935],
        [143.85447382, -26.14109681],
        [146.15002393, -25.57005134],
        [148.44557405, -24.97748207],
        [150.74112416, -24.36332468],
    ]
    data = np.array(data)
    eos = EOS(data[:, 0], data[:, 1])
    assert eos.eval(100) == pytest.approx(-36.70823703028814, rel=1e-8)
    assert eos.v0 == pytest.approx(76.06847295338216, rel=1e-8)
    assert eos.e0 == pytest.approx(-40.39148500307708, rel=1e-8)
    assert eos.b0 == pytest.approx(261.94623797294673, rel=1e-8)

    true = [
        [-37.95927901476747, -60.400545181201416],
        [-40.36702977434097, -61.93488851920077],
    ]
    np.testing.assert_allclose(eos.eval_gibbs_pressure([100, 120]), true)
